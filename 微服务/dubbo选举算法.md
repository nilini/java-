####选举机制

###作用
* master节点选举，主节点挂了以后，从节点会接手工作，并保证这个节点是唯一的，从而保证集群的高可用。
* 统一配置文件管理，即只需要部署一台服务器，则可以把相同的配置文件同步更新到所有的服务器。
* 发布和订阅。类似MQ、dubbo发布者把数据存在znode，订阅者会读取这个数据。
* 提供分布式锁，分布式环境中不同进程之间争夺资源，类似多线程中的锁。
* 集群管理，集群中保证数据的一致性。

###选举算法
* LeaderElection
* AuthFastLeaderElection
* FastLeaderElection
默认的算法是FastLeaderElection。

###主要概念
* 服务器ID：编号越大的在选举算法中的权重越大。
* 数据ID：服务器中存放的最大数据ID，值越大说明数据越新，在选举算法中数据越新权重越大。
* 逻辑时钟：即投票的次数，同一轮投票过程中的逻辑时钟是相同的，每投完一次票这个数据就会增加，然后与接收到的其他服务器返回的投票信息中的数值相比，根据不同的值做出不同的判断。

###选举消息内容
在投票完成后，需要将投票信息发送给集群中的所有服务器。包含:
* 服务器ID
* 数据ID
* 逻辑时钟
* 选举状态

###选举状态
* LOOKING 竞选状态
* FOLLOWING 随从状态，同步 leader 状态，参与投票
* OBSERVING 观察状态，同步 leader 状态，不参与投票
* LEADING 领导者状态

###选举过程
* 选举必须在同一轮次中进行
* 先比较数据ID，再比较服务器ID
* 一旦出现某个节点被过半推选，那么该节点晋升为Leader

###奇数节点
1、防止脑裂造成的集群不可用
集群的脑裂通常发生在节点之间通信不可达的情况下，集群会分裂成不同的小集群，小集群各自选出自己的master节点，导致原有的集群出现多个master节点的情况。

规定：可用节点数量 > （集群节点总数/2）
如果不这样规定，则会出现分裂成两个偶数节点小集群的情况，每个集群都能选出一个master，造成集群不可用。

2、在容错能力相同的情况下，奇数台更节省资源
5节点集群和6节点集群都只允许一个节点宕机。