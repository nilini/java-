mysql行锁
1、行锁就是针对数据表中行记录的锁，事务A更新了一行，而这时候事务B也要更新同一行，则必须等事务A的操作完成后才能进行个更新。
2、InnoDB事务中，行锁是在需要的时候才加上的，但并不是不需要了就立刻释放，而是等到事务结束时才释放。这就是两阶段锁协议。
3、如果事务中需要多个锁，要把最可能造成锁冲突、最可能影响并发度的锁尽量往后放。
4、死锁：
    进入死锁后，有两种策略：
        1）直接进入等待，直到超时，这个时间可以通过参数innodb_lock_wait_timeout来设置。
        2）发起死锁检测，发现死锁后，主动回滚死锁链条中的某一个事务，让其他事务得以继续执行，设置参数innodb_deadlock_detect为on。
        
    每个新来的被堵住的线程，都要判断会不会由于自己的加入导致了死锁，这是一个时间复杂度O(N)的操作。会消耗大量cpu资源。解决方法：
        1）确保业务中一定不会出现死锁，可以临时把死锁检测观掉。
        2）控制并发度。
        3）将一行数据改成逻辑上的多行来减少锁冲突。
        4）如果事务中需要锁定多行，要把最可能造成锁冲突、最可能影响并发度的锁的申请时机尽量往后放。